function load_triangle_simulation

clear all
close all

draw = true;
rerun_flag = true;
save_state = true;
draw = true;

fs = filesep;
mass_flag = true;

type = 'triangle';

axis_box = [-1 1.5 -0.5 1];
% options = optimoptions('fsolve','Algorithm','levenberg-marquardt');
options = optimoptions('fsolve','TolFun',1.e-9,'TolX',1.e-9,'Display','final');

maxA_list = [0.01 0.001]';
%         meshname = sprintf('simData%ctrimeshes%c%s maxA%.e',fs,fs,type, maxA);
trajectories = cell(size(maxA_list));
positionsMs = cell(size(maxA_list));
indLogicals = cell(size(maxA_list));
elems = cell(size(maxA_list)); % faces
% meshname = sprintf('simData%ctrimeshes%c%s maxA%.e tritool%s',fs,fs,type, maxA);
for i_maxA = 1:length(maxA_list)
    maxA = maxA_list(i_maxA);
    meshname = sprintf('simData%ctrimeshes%c%s maxA%.e%s',fs,fs,type, maxA,'triangle');
    if exist([meshname '.mat'], 'file') ~= 2
        disp('mesh does not exist')
        
    else
        load([meshname '.mat'], 'nodeM', 'elem');
        
    end
    
    
    elem(:,[1 3]) = elem(:,[3 1]);
    
    N = size(nodeM,1);
    
    Y = 10; % Young's modululs
    P = 0.48; % Poisson ratio
    rho = 1; % density
    a = 0.0; % rayleigh damping
    b = 0.0;
    
    filename = sprintf('simData%c%s maxA%.e', fs, type, maxA);
    filename = [filename '_linear'];
    
    
    fname = [filename 'Trajectory'];
    
    load(fname,'trajectory','tsteps','dt','positionsM','indLogical');
    
    trajectories{i_maxA} = trajectory;
    positionsMs{i_maxA} = positionsM;
    indLogicals{i_maxA} = indLogical;
    elems{i_maxA} = elem;
end

if draw
    
    vidname = strcat('linear_triangle_comp','.avi');
    vid = VideoWriter(vidname);
    vid.FrameRate = 60;
    open(vid);
end

handles_list = cell(size(maxA_list));

% draw the initial frame to get the graphic handles
% for iA = 1:length(trajectories)
%     u = trajectories{iA}(:,1);
%     
%     
%     if(draw)
%         
%         
%         node = u(1:end/2) + positionsMs{iA}(indLogicals{iA});
%         node = transpose(reshape(node,2,[]));
%         handles_list{iA} = trimesh(elems{iA},node(:,1),node(:,2),zeros(size(node,1),1),iA*ones(size(node,1),1));
%         %     trimesh(elem,node(:,1)+firstMode(1:2:end),node(:,2)+firstMode(2:2:end),zeros(size(node,1),1),zeros(size(node,1),1));
%         
%         
%     end
%     hold on
%     
% end

% rate to draw the scene
sim_rate = round(1/dt);
draw_rate = round(sim_rate/vid.FrameRate);
axis_box = [-0.75 1.25 -0.5 1.5];
hf = figure;
for ti = 1:tsteps
    cla
    for iA = 1:length(trajectories)
        u = trajectories{iA}(:,ti);
        
        
        if(draw)
            if or(mod(ti, draw_rate) == 1, draw_rate == 1)
                
                node = u(1:end/2) + positionsMs{iA}(indLogicals{iA});
                node = transpose(reshape(node,2,[]));
                trimesh(elems{iA},node(:,1),node(:,2),zeros(size(node,1),1),iA*ones(size(node,1),1),'FaceAlpha',0.0,'EdgeAlpha',0.5);
                axis(axis_box)
                axis equal
                drawnow
                hold on
%                 handles_list{iA}.XData = node(:,1);
%                 handles_list{iA}.YData = node(:,2);

            end
            
        end
        
    end

    if save_state
        frame = getframe(hf);
        writeVideo(vid,frame);
    end
    
    
end